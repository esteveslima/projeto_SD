
FROM node:12-alpine as nodeBuilderStage  


WORKDIR /container


COPY package.json .

RUN npm install 

COPY . .

# Loading args from docker-compose to container runtime build
ARG REACT_APP_USER_HOST 
ARG REACT_APP_USER_PORT 
ARG REACT_APP_USER_ROUTE 
ARG REACT_APP_QUEUE_HOST 
ARG REACT_APP_QUEUE_PORT
ARG REACT_APP_QUEUE_ROUTE 
ARG REACT_APP_GAME_HOST 
ARG REACT_APP_GAME_PORT
ARG REACT_APP_GAME_ROUTE 
ARG REACT_APP_STORE_HOST 
ARG REACT_APP_STORE_PORT 
ARG REACT_APP_STORE_ROUTE 

# Enabling react to build with provided environment variables from args in docker-compose
ENV REACT_APP_USER_HOST $REACT_APP_USER_HOST
ENV REACT_APP_USER_PORT $REACT_APP_USER_PORT
ENV REACT_APP_USER_ROUTE $REACT_APP_USER_ROUTE
ENV REACT_APP_QUEUE_HOST $REACT_APP_QUEUE_HOST
ENV REACT_APP_QUEUE_PORT $REACT_APP_QUEUE_PORT
ENV REACT_APP_QUEUE_ROUTE $REACT_APP_QUEUE_ROUTE
ENV REACT_APP_GAME_HOST $REACT_APP_GAME_HOST
ENV REACT_APP_GAME_PORT $REACT_APP_GAME_PORT
ENV REACT_APP_GAME_ROUTE $REACT_APP_GAME_ROUTE
ENV REACT_APP_STORE_HOST $REACT_APP_STORE_HOST
ENV REACT_APP_STORE_PORT $REACT_APP_STORE_PORT
ENV REACT_APP_STORE_ROUTE $REACT_APP_STORE_ROUTE

# .env file not useful when creating static files with react, using args in docker-compose instead
RUN npm run build


FROM nginx

EXPOSE 80


COPY --from=nodeBuilderStage /container/build /usr/share/nginx/html
